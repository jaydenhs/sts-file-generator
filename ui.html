<head>
  <style>
    * {
      font-family: 'Inter', sans-serif;
    }

    h1 {
      margin-bottom: -0.5rem;
    }

    h2 {
      margin-bottom: 0.5rem;
    }

    #container {
      margin-bottom: 1.5rem;
    }
  </style>

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
</head>

<body>
  <h1>StructionSite File Generator</h1>
  <div id="container"></div>

  <button id="finish">Finish</button>
  <button id="cancel">Cancel</button>
</body>

<script>
  const members = {
    "PMs": [
      "Tom Alterman",
      "Brie Williams",
    ],
    "Designers": [
      "Jayden Hsiao",
      "Wayde Mecham",
      "Sudeshna Pantham",
      "Deyge Falanai"
    ]
  };

  function abbrev_name(name) {
    var split_names = name.trim().split(" ");
    if (split_names.length > 1) {
      return (split_names[0] + " " + split_names[1].charAt(0) + ".");
    }
    return split_names[0];
  };

  // Container <div> where dynamic content will be placed
  const container = document.getElementById("container");
  for (const role in members) {
    const roleTitle = document.createElement("h2")
    roleTitle.innerHTML = role
    container.appendChild(roleTitle);

    for (const name of members[role]) {
      const input = document.createElement("input");
      input.type = "checkbox";
      input.id = name;
      input.name = role;
      input.value = abbrev_name(name);
      container.appendChild(input);

      const label = document.createElement("label");
      label.htmlFor = name;
      label.innerHTML = name;
      container.appendChild(label);

      container.appendChild(document.createElement("br"));
    }
  }

  document.getElementById("finish").onclick = () => {
    var designers = PMs = "";
    var markedCheckbox = document.getElementsByTagName("input");
    for (var checkbox of markedCheckbox) {
      if (checkbox.checked) {
        if (checkbox.name === "Designers") {
          designers = designers.concat(` ${checkbox.value},`);
        } else if (checkbox.name === "PMs") {
          PMs = PMs.concat(` ${checkbox.value},`);
        }
      }
    }
    designers = designers.slice(0, -1);
    PMs = PMs.slice(0, -1);
    parent.postMessage({ pluginMessage: { type: "finish", designers, PMs } }, "*");
  };

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };
</script>